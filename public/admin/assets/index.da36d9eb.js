var U=Object.defineProperty;var q=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var H=(u,t,e)=>t in u?U(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e,g=(u,t)=>{for(var e in t||(t={}))j.call(t,e)&&H(u,e,t[e]);if(q)for(var e of q(t))W.call(t,e)&&H(u,e,t[e]);return u};var x=(u,t,e)=>new Promise((p,s)=>{var c=r=>{try{m(e.next(r))}catch(f){s(f)}},_=r=>{try{m(e.throw(r))}catch(f){s(f)}},m=r=>r.done?p(r.value):Promise.resolve(r.value).then(c,_);m((e=e.apply(u,t)).next())});import{b as Y,s as G,u as J}from"./useModal.4645bda0.js";import{d as L,b9 as K,r as h,a4 as A,i,e as S,x as Q,aA as X,w as n,h as o,j as B,t as b,az as I,g as R,av as Z,aY as ee,l as P,D as O,E as te,aN as ne,a2 as oe,aW as T,aq as se,_ as ae,ba as ue,s as le,v as $,N as M,f as ce,p as re,q as ie,bb as _e,n as de}from"./index.b843bef0.js";import"./index.esm.39384bc5.js";const pe={class:"w-full cursor-move",id:"basic-modal-bar"},fe=B("\u53D6\u6D88"),me=L({__name:"BasicModal",props:g({},Y),emits:["on-close","on-ok","register"],setup(u,{emit:t}){const e=u,p=K(),s=h(null),c=h(!1),_=h(!1),m=A(()=>g(g({},e),i(s))),r=A(()=>{const{subBtuText:a}=s.value;return a||e.subBtuText});function f(a){return x(this,null,function*(){s.value=ne(i(s)||{},a)})}const F=A(()=>g(g(g({},p),i(m)),i(s)));function D(a){_.value=a}function C(){c.value=!0,oe(()=>{const a=document.getElementById("basic-modal"),y=document.getElementById("basic-modal-bar");G(y,a)})}function l(){c.value=!1,_.value=!1,t("on-close")}function v(){c.value=!1,t("on-close")}function d(){_.value=!0,console.log(_.value),t("on-ok")}const E={setProps:f,openModal:C,closeModal:l,setSubLoading:D};return ee()&&t("register",E),(a,y)=>{const k=P,w=O,V=te;return S(),Q(V,Z({id:"basic-modal"},i(F),{show:c.value,"onUpdate:show":y[0]||(y[0]=z=>c.value=z),onClose:v}),X({header:n(()=>[R("div",pe,b(i(F).title),1)]),default:n(()=>[I(a.$slots,"default")]),_:2},[a.$slots.action?{name:"action",fn:n(()=>[I(a.$slots,"action")])}:{name:"action",fn:n(()=>[o(w,null,{default:n(()=>[o(k,{onClick:l},{default:n(()=>[fe]),_:1}),o(k,{type:"primary",loading:_.value,onClick:d},{default:n(()=>[B(b(i(r)),1)]),_:1},8,["loading"])]),_:1})])}]),1040,["show"])}}});function ve(){return T.request({url:"/master/ota/check",method:"get"})}function ge(){return T.request({url:"/master/ota/update",method:"get"},{isTransformResponse:!1})}function Be(){return T.request({url:"/master/ota/database",method:"get"},{isTransformResponse:!1})}function ye(){return T.request({url:"/master/ota/script",method:"get"},{isTransformResponse:!1})}const be="yyyy-MM-dd HH:mm:ss";function he(u,t=be){return se(u,t)}const Ce=["innerHTML"],Fe=B(" \u68C0\u67E5\u66F4\u65B0 "),ke=B(" \u7ACB\u5373\u66F4\u65B0 "),xe=["textContent"],Me=L({__name:"index",setup(u){const t=ue(),e=le({current_version:"",version:"",message:""}),p=h(!1),s=h(!1),c=h(""),[_,{openModal:m,closeModal:r}]=J({title:"\u5728\u7EBF\u66F4\u65B0",closeOnEsc:!1,showIcon:!1});f();function f(){p.value=!0,ve().then(l=>{for(const v in l)e[v]=l[v];e.current_version!==e.version&&t.info({title:"\u53D1\u73B0\u65B0\u7248",content:()=>$("div",{},["\u5F53\u524D\u7248\u672C: ",$(M,{type:"info"},e.current_version),"\uFF0C\u6700\u65B0\u7248\u672C: ",$(M,{type:"info"},e.version),"\uFF0C\u662F\u5426\u8FDB\u884C\u66F4\u65B0\uFF1F"])})}).finally(()=>p.value=!1)}function F(){t.info({title:"\u6E29\u99A8\u63D0\u9192",content:"\u60A8\u786E\u5B9A\u66F4\u65B0\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>x(this,null,function*(){m(),s.value=!0;const l=[ge,Be,ye];try{for(let v of l){const d=yield v();if(console.log(d),C(d.message),d.status!=="ok"){C("\u7EC8\u6B62\u66F4\u65B0~");break}}C("\u66F4\u65B0\u5B8C\u6BD5~")}finally{s.value=!1}}),onNegativeClick:()=>{}})}function D(){return x(this,null,function*(){r(),s.value=!1})}function C(l){l=`
[${he(new Date,"yyyy-MM-dd HH:mm:ss")}] ${l}`,c.value=(c.value.trim()+l).trim()}return(l,v)=>{const d=re,E=ie,N=_e,a=P,y=O,k=de,w=me;return S(),ce("div",null,[o(k,{bordered:!1,title:"\u5728\u7EBF\u5347\u7EA7",class:"mt-4 proCard",size:"small",segmented:{content:!0}},{default:n(()=>[o(N,{show:p.value},{default:n(()=>[o(E,{bordered:"","label-placement":"left",class:"py-2",column:2},{default:n(()=>[o(d,{label:"\u5F53\u524D\u7248\u672C"},{default:n(()=>[o(i(M),{type:"info"},{default:n(()=>[B(b(e.current_version),1)]),_:1})]),_:1}),o(d,{label:"\u6700\u65B0\u7248\u672C"},{default:n(()=>[o(i(M),{type:"info"},{default:n(()=>[B(b(e.version),1)]),_:1})]),_:1}),o(d,{label:"\u65B0\u7248\u7279\u6027"},{default:n(()=>[R("div",{class:"news",innerHTML:e.message},null,8,Ce)]),_:1})]),_:1})]),_:1},8,["show"]),o(y,{size:"large",class:"mt-4"},{default:n(()=>[o(a,{strong:"",type:"primary",onClick:f,loading:p.value},{default:n(()=>[Fe]),_:1},8,["loading"]),o(a,{strong:"",type:"primary",onClick:F,loading:s.value},{default:n(()=>[ke]),_:1},8,["loading"])]),_:1})]),_:1}),o(w,{onRegister:i(_),ref:"modalRef",class:"console-modal"},{default:n(()=>[R("div",{class:"console",textContent:b(c.value)},null,8,xe)]),action:n(()=>[o(a,{type:"primary",loading:s.value,onClick:D},{default:n(()=>[B(b(s.value?"\u6B63\u5728\u66F4\u65B0":"\u5B8C\u6210\u66F4\u65B0"),1)]),_:1},8,["loading"])]),_:1},8,["onRegister"])])}}});var Ae=ae(Me,[["__scopeId","data-v-8d4d6070"]]);export{Ae as default};
