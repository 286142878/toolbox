var U=Object.defineProperty;var H=Object.getOwnPropertySymbols;var j=Object.prototype.hasOwnProperty,W=Object.prototype.propertyIsEnumerable;var I=(a,t,e)=>t in a?U(a,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[t]=e,B=(a,t)=>{for(var e in t||(t={}))j.call(t,e)&&I(a,e,t[e]);if(H)for(var e of H(t))W.call(t,e)&&I(a,e,t[e]);return a};var k=(a,t,e)=>new Promise((p,s)=>{var l=c=>{try{v(e.next(c))}catch(f){s(f)}},_=c=>{try{v(e.throw(c))}catch(f){s(f)}},v=c=>c.done?p(c.value):Promise.resolve(c.value).then(l,_);v((e=e.apply(a,t)).next())});import{b as Y,s as G,u as J}from"./useModal.03d1e420.js";import{d as P,b9 as K,r as C,a4 as $,i as r,e as S,x as Q,aA as X,w as n,h as o,j as y,t as h,az as L,g as N,av as Z,aY as ee,l as O,D as V,E as te,aN as ne,a2 as oe,aW as T,aq as se,_ as ae,ba as ue,s as le,v as R,N as M,f as ce,p as ie,q as re,bb as _e,n as de}from"./index.5d02c90a.js";import"./index.esm.2902f313.js";const pe={class:"w-full cursor-move",id:"basic-modal-bar"},fe=y("\u53D6\u6D88"),me=P({__name:"BasicModal",props:B({},Y),emits:["on-close","on-ok","register"],setup(a,{emit:t}){const e=a,p=K(),s=C(null),l=C(!1),_=C(!1),v=$(()=>B(B({},e),r(s))),c=$(()=>{const{subBtuText:u}=s.value;return u||e.subBtuText});function f(u){return k(this,null,function*(){s.value=ne(r(s)||{},u)})}const F=$(()=>B(B(B({},p),r(v)),r(s)));function D(u){_.value=u}function E(){l.value=!0,oe(()=>{const u=document.getElementById("basic-modal"),m=document.getElementById("basic-modal-bar");G(m,u)})}function b(){l.value=!1,_.value=!1,t("on-close")}function i(){l.value=!1,t("on-close")}function g(){_.value=!0,console.log(_.value),t("on-ok")}const d={setProps:f,openModal:E,closeModal:b,setSubLoading:D};return ee()&&t("register",d),(u,m)=>{const x=O,w=V,A=te;return S(),Q(A,Z({id:"basic-modal"},r(F),{show:l.value,"onUpdate:show":m[0]||(m[0]=z=>l.value=z),onClose:i}),X({header:n(()=>[N("div",pe,h(r(F).title),1)]),default:n(()=>[L(u.$slots,"default")]),_:2},[u.$slots.action?{name:"action",fn:n(()=>[L(u.$slots,"action")])}:{name:"action",fn:n(()=>[o(w,null,{default:n(()=>[o(x,{onClick:b},{default:n(()=>[fe]),_:1}),o(x,{type:"primary",loading:_.value,onClick:g},{default:n(()=>[y(h(r(c)),1)]),_:1},8,["loading"])]),_:1})])}]),1040,["show"])}}});function ve(){return T.request({url:"/master/ota/check",method:"get"})}function ge(){return T.request({url:"/master/ota/update",method:"get"},{isTransformResponse:!1})}function Be(){return T.request({url:"/master/ota/database",method:"get"},{isTransformResponse:!1})}function ye(){return T.request({url:"/master/ota/script",method:"get"},{isTransformResponse:!1})}const be="yyyy-MM-dd HH:mm:ss";function he(a,t=be){return se(a,t)}const Ce=["innerHTML"],Fe=y(" \u68C0\u67E5\u66F4\u65B0 "),xe=y(" \u7ACB\u5373\u66F4\u65B0 "),ke=["textContent"],Me=P({__name:"index",setup(a){const t=ue(),e=le({current_version:"",version:"",message:""}),p=C(!1),s=C(!1),l=C(""),[_,{openModal:v,closeModal:c}]=J({title:"\u5728\u7EBF\u66F4\u65B0",closeOnEsc:!1,showIcon:!1});f();function f(){p.value=!0,ve().then(i=>{for(const g in i)e[g]=i[g];e.current_version!==e.version&&t.info({title:"\u53D1\u73B0\u65B0\u7248",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",content:()=>R("div",{},["\u5F53\u524D\u7248\u672C: ",R(M,{type:"info"},e.current_version),"\uFF0C\u6700\u65B0\u7248\u672C: ",R(M,{type:"info"},e.version),"\uFF0C\u662F\u5426\u8FDB\u884C\u66F4\u65B0\uFF1F"]),onPositiveClick:()=>{F()}})}).finally(()=>p.value=!1)}function F(){return k(this,null,function*(){v(),s.value=!0;const i=[ge,Be,ye];try{for(let g of i){const d=yield g();if(console.log(d),b(d.message),d.status!=="ok"){b("\u7EC8\u6B62\u66F4\u65B0~");break}}b("\u66F4\u65B0\u5B8C\u6BD5~")}finally{s.value=!1}})}function D(){t.info({title:"\u6E29\u99A8\u63D0\u9192",content:"\u60A8\u786E\u5B9A\u66F4\u65B0\uFF1F",positiveText:"\u786E\u5B9A",negativeText:"\u53D6\u6D88",onPositiveClick:()=>{F()},onNegativeClick:()=>{}})}function E(){return k(this,null,function*(){c(),s.value=!1})}function b(i){i=`
[${he(new Date,"yyyy-MM-dd HH:mm:ss")}] ${i}`,l.value=(l.value.trim()+i).trim()}return(i,g)=>{const d=ie,q=re,u=_e,m=O,x=V,w=de,A=me;return S(),ce("div",null,[o(w,{bordered:!1,title:"\u5728\u7EBF\u5347\u7EA7",class:"mt-4 proCard",size:"small",segmented:{content:!0}},{default:n(()=>[o(u,{show:p.value},{default:n(()=>[o(q,{bordered:"","label-placement":"left",class:"py-2",column:2},{default:n(()=>[o(d,{label:"\u5F53\u524D\u7248\u672C"},{default:n(()=>[o(r(M),{type:"info"},{default:n(()=>[y(h(e.current_version),1)]),_:1})]),_:1}),o(d,{label:"\u6700\u65B0\u7248\u672C"},{default:n(()=>[o(r(M),{type:"info"},{default:n(()=>[y(h(e.version),1)]),_:1})]),_:1}),o(d,{label:"\u65B0\u7248\u7279\u6027"},{default:n(()=>[N("div",{class:"news",innerHTML:e.message},null,8,Ce)]),_:1})]),_:1})]),_:1},8,["show"]),o(x,{size:"large",class:"mt-4"},{default:n(()=>[o(m,{strong:"",type:"primary",onClick:f,loading:p.value},{default:n(()=>[Fe]),_:1},8,["loading"]),o(m,{strong:"",type:"primary",onClick:D,loading:s.value},{default:n(()=>[xe]),_:1},8,["loading"])]),_:1})]),_:1}),o(A,{onRegister:r(_),ref:"modalRef",class:"console-modal"},{default:n(()=>[N("div",{class:"console",textContent:h(l.value)},null,8,ke)]),action:n(()=>[o(m,{type:"primary",loading:s.value,onClick:E},{default:n(()=>[y(h(s.value?"\u6B63\u5728\u66F4\u65B0":"\u5B8C\u6210\u66F4\u65B0"),1)]),_:1},8,["loading"])]),_:1},8,["onRegister"])])}}});var Ae=ae(Me,[["__scopeId","data-v-315e28ce"]]);export{Ae as default};
